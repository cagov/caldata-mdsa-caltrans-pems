version: 2

models:
  - name: int_pems__det_diag_set_assignment
    description: |
      This SQL file assigns the correct values to appropriate districts and types.
    columns:
      - name: meta_date
        description: Date of the metadata file.
      - name: station_id
        description: |
          An integer value that uniquely indenties the Station Metadata.
          Use this value to 'join' other clearinghouse files that contain Station Metadata.
        tests:
          - not_null          
      - name: district
        description: The district in which the VDS is located. Values are 1-12.
      - name: type
        description: Two character string identify the VDS type.
      - name: station_diagnostic_set_id
        description: Detector threshold set assigned to station.
      - name: station_diagnostic_method_id
        description: Detector deployment location in the field.
      - name: high_occupancy
        description: |
          The high-occupancy threshold for station diagnostics, above which the
          values are considered suspicious.
      - name: high_flow
        description: |
          The high-flow threshold for station diagnostics, above which the
          values are considered suspicious.
      - name: high_occ_percent
        description: |
          The high occupancy percentage threshold for station diagnostics above which
          the number of high occupancy values that occur at a station are suspect
          No. of high occ samples > % of the max collected samples during the test period
      - name: zero_occ_percent
        description: |
          The zero occupancy percentage threshold for station diagnostics above which
          the number of zero occupancy values that occur at a station are suspect
          No. of zero occ samples > % of the max collected samples during the test period
      - name: flow_occ_percent
        description: |
          The percentage threshold for station diagnostics where the number of
          flow = 0 and occupancy > 0 values that occur at a station are suspect
          No. of flow-occ mismatch samples > % of the max collected samples during the
          test period.
      - name: occ_flow_percent
        description: |
          The percentage threshold for station diagnostics where the number of
          occupany = 0 and flow > 0 values that occur at a station are suspect
          No. of flow-occ mismatch samples > % of the max collected samples during the
          test period.
      - name: repeat_occ
        description: |
          The high-occupancy threshold for station diagnostics, above which the
          values are considered suspicious
          No. of repeated occupancy values > 5-min samples
      - name: high_flow_percent
        description: |
          The percentage threshold for station diagnostics where the number of high flow
          values that occur at a station are suspect
          No. of high flow samples > % of the max collected samples during the test period
      - name: zero_flow_percent
        description: |
          The percentage threshold for station diagnostics where the number of zero flow
          values that occur at a station are suspect
          No. of zero flow samples > % of the max collected samples during the test period
    tests:
      - dbt_utils.equal_rowcount:
          compare_model: ref('int_clearinghouse__most_recent_station_meta')

  - name: int_pems__detector_status
    description: |
      This file contains count data by station and lane based on the number of raw data samples
      that met a variety of flow and occupancy criteria. This data will be used to determine the
      diagnostic value associated with a detector.
    columns:
      - name: sample_date
        description: The date associated with raw data samples being counted.
      - name: station_id
        description: |
          An integer value that uniquely indentifies a station.
          Use this value to 'join' other files or tables that contain the Station ID value.
        tests:
          - not_null
      - name: lane
        description: Lane associated with a route and station
      - name: station_diagnostic_method_id
        description: Detector deployment location in the field
      - name: sample_ct
        description: |
          Counts the number of raw data samples where a lane's volume (flow) and occupancy
          values contain any value by station.
      - name: zero_vol_ct
        description: |
          Counts the number of raw data samples where a lane's volume (flow) value
          equals 0 by station.
      - name: zero_occ_ct
        description: |
          Counts the number of raw data samples where a lane's occupancy
          value equals 0 by station.
      - name: zero_vol_pos_occ_ct
        description: |
          Counts the number of raw data samples where a lane's volume (flow)
          value equals 0 but occupancy is greater than 0 by station.
      - name: zero_occ_pos_vol_ct
        description: |
          Counts the number of raw data samples where a lane's occupancy
          value equals 0 but volume (flow) is greater than 0 by station.
      - name: high_volume_ct
        description: |
          Counts the number of volume (flow) values in a lane that exceeded the high value threshold
          detector diagnostic parameter for a station.
      - name: high_occupancy_ct
        description: |
          Counts the number of occupancy values in a lane that exceeded the high value threshold
          detector diagnostic parameter for a station.
      - name: status
        description: |
          The detector diagnostic status based on testing multiple diagnostic test conditions
